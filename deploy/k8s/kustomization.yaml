apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ai-orchestrator

resources:
  - namespace.yaml
  - configmap.yaml
  - secrets.yaml
  - mongodb.yaml
  - victoriametrics.yaml
  - vmui.yaml
  - worker-gateway.yaml
  - control-plane.yaml
  - nginx.yaml

commonLabels:
  app.kubernetes.io/managed-by: kustomize
  app.kubernetes.io/part-of: ai-orchestrator

images:
  - name: ai-orchestrator/control-plane
    newName: ghcr.io/your-org/ai-orchestrator/control-plane
    newTag: latest
  - name: ai-orchestrator/worker-gateway
    newName: ghcr.io/your-org/ai-orchestrator/worker-gateway
    newTag: latest

# To override defaults, copy config.env.example to config.env and modify:
# cp config.env.example config.env
configMapGenerator:
  - name: orchestrator-config-env
    behavior: merge
    envs:
      - config.env

replacements:
  - source:
      kind: ConfigMap
      name: orchestrator-config
      fieldPath: data.VictoriaMetrics__Url
    targets:
      - select:
          kind: Deployment
          name: control-plane
        fieldPaths:
          - spec.template.spec.containers.[name=control-plane].env.[name=VictoriaMetrics__Url].value
      - select:
          kind: Deployment
          name: worker-gateway
        fieldPaths:
          - spec.template.spec.containers.[name=worker-gateway].env.[name=VictoriaMetrics__Url].value

patchesStrategicMerge: []

patchesJson6902: []
