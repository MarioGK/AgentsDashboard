{{- $fullName := include "ai-orchestrator.fullname" . }}
{{- $namespace := include "ai-orchestrator.namespace" . }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $fullName }}-mongodb
  namespace: {{ $namespace }}
  labels:
    {{- include "ai-orchestrator.commonLabels" . | nindent 4 }}
type: Opaque
{{- if not .Values.mongodb.auth.existingSecret }}
data:
  mongodb-root-user: {{ .Values.mongodb.auth.rootUser | b64enc | quote }}
  mongodb-root-password: {{ .Values.mongodb.auth.rootPassword | b64enc | quote }}
  mongodb-database: {{ .Values.mongodb.auth.database | b64enc | quote }}
  mongodb-connection-string: {{ (printf "mongodb://%s:%s@%s-mongodb:%d/%s?authSource=admin" .Values.mongodb.auth.rootUser .Values.mongodb.auth.rootPassword $fullName (int .Values.service.mongodb.port) .Values.mongodb.auth.database) | b64enc | quote }}
{{- else }}
data:
  mongodb-root-user: ""
  mongodb-root-password: ""
  mongodb-database: {{ .Values.mongodb.auth.database | b64enc | quote }}
  mongodb-connection-string: ""
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $fullName }}-api-keys
  namespace: {{ $namespace }}
  labels:
    {{- include "ai-orchestrator.commonLabels" . | nindent 4 }}
type: Opaque
{{- if not .Values.apiKeys.existingSecret }}
data:
  openai-api-key: {{ .Values.apiKeys.openai | default "" | b64enc | quote }}
  anthropic-api-key: {{ .Values.apiKeys.anthropic | default "" | b64enc | quote }}
  zhipuai-api-key: {{ .Values.apiKeys.zhipuai | default "" | b64enc | quote }}
  github-token: {{ .Values.apiKeys.github.token | default "" | b64enc | quote }}
  github-app-id: {{ .Values.apiKeys.github.appId | default "" | b64enc | quote }}
  github-app-private-key: {{ .Values.apiKeys.github.appPrivateKey | default "" | b64enc | quote }}
{{- else }}
data:
  openai-api-key: ""
  anthropic-api-key: ""
  zhipuai-api-key: ""
  github-token: ""
  github-app-id: ""
  github-app-private-key: ""
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $fullName }}-docker
  namespace: {{ $namespace }}
  labels:
    {{- include "ai-orchestrator.commonLabels" . | nindent 4 }}
type: Opaque
{{- if not .Values.docker.existingSecret }}
data:
  docker-registry: {{ .Values.docker.registry | default "" | b64enc | quote }}
  docker-username: {{ .Values.docker.username | default "" | b64enc | quote }}
  docker-password: {{ .Values.docker.password | default "" | b64enc | quote }}
{{- else }}
data:
  docker-registry: ""
  docker-username: ""
  docker-password: ""
{{- end }}
---
{{- if .Values.docker.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.docker.existingSecret }}
  namespace: {{ $namespace }}
  labels:
    {{- include "ai-orchestrator.commonLabels" . | nindent 4 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ printf "{\"auths\":{\"%s\":{\"username\":\"%s\",\"password\":\"%s\"}}}" .Values.docker.registry .Values.docker.username .Values.docker.password | b64enc | quote }}
{{- end }}
