@namespace AgentsDashboard.ControlPlane.Components.Workspace

@using AgentsDashboard.ControlPlane.Components.Shared

<div class="workspace-thread-composer">
    <TaskPromptComposer InputId="@ComposerInputId"
                        Value="@ComposerValue"
                        ValueChanged="OnComposerValueChanged"
                        Images="@ComposerImages"
                        ImagesChanged="OnComposerImagesChanged"
                        HelperText="@ComposerHelperText"
                        Rows="7"
                        ShowGhostSuggestion="true"
                        GhostSuffix="@GhostSuffix"
                        PasteBridgeKey="workspace-composer"
                        Disabled="@(IsSubmitting || IsComposerBlocked)"
                        ShowSubmitButton="true"
                        SubmitTooltip="Send"
                        OnSubmit="SubmitRequested"
                        OnImprove="OnImprove"
                        OnGenerate="OnGenerate"
                        OnKeyDown="OnComposerKeyDown"
                        OnValidationError="OnValidationError" />

    <MudStack Row AlignItems="AlignItems.Center" Spacing="1" Class="workspace-thread-composer-actions">
        @if (IsSubmitting)
        {
            <MudChip T="string" Size="Size.Small" Color="Color.Info" Variant="Variant.Outlined" Class="workspace-thread-composer-status-chip">
                <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-1" />
                Sending...
            </MudChip>
        }
        @if (IsComposerBlocked)
        {
            <MudChip T="string" Size="Size.Small" Color="Color.Error" Variant="Variant.Outlined" Class="workspace-thread-composer-status-chip">
                @ComposerBlockReason
            </MudChip>
        }
    </MudStack>
</div>

@code {
    [Parameter, EditorRequired] public string ComposerInputId { get; set; } = string.Empty;
    [Parameter] public string ComposerValue { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> OnComposerValueChanged { get; set; }
    [Parameter] public IReadOnlyList<WorkspaceImageInput> ComposerImages { get; set; } = [];
    [Parameter] public EventCallback<IReadOnlyList<WorkspaceImageInput>> OnComposerImagesChanged { get; set; }
    [Parameter] public bool IsSubmitting { get; set; }
    [Parameter] public bool IsComposerBlocked { get; set; }
    [Parameter] public string ComposerBlockReason { get; set; } = string.Empty;
    [Parameter] public string ComposerHelperText { get; set; } = "Enter to send. Shift+Enter inserts a new line. Paste or upload images.";
    [Parameter] public string GhostSuffix { get; set; } = string.Empty;
    [Parameter] public EventCallback SubmitRequested { get; set; }
    [Parameter] public EventCallback OnImprove { get; set; }
    [Parameter] public EventCallback OnGenerate { get; set; }
    [Parameter] public EventCallback<KeyboardEventArgs> OnComposerKeyDown { get; set; }
    [Parameter] public EventCallback<string> OnValidationError { get; set; }
}
