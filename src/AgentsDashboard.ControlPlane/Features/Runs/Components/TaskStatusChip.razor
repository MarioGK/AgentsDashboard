@namespace AgentsDashboard.ControlPlane.Components


<MudTooltip Text="@TooltipText">
    <MudChip T="string" Size="@Size" Color="@ChipColor" Variant="@Variant">
        @if (IsLoading || Status.IsWorking)
        {
            <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-1" />
        }
        @LabelText
    </MudChip>
</MudTooltip>

@code {
    [Parameter, EditorRequired] public TaskDocument Task { get; set; } = default!;
    [Parameter] public RunDocument? LatestRun { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public Size Size { get; set; } = Size.Small;
    [Parameter] public Variant Variant { get; set; } = Variant.Filled;

    private TaskStatusChipVisual Status => TaskRunStatusPresentation.FromTaskAndLatestRun(Task, LatestRun);
    private string TooltipText => IsLoading ? $"{Status.Tooltip} (Refreshing latest status...)" : Status.Tooltip;
    private string LabelText => Status.Label;
    private Color ChipColor => Status.Color;
}
