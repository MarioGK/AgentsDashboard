# Install AgentsDashboard/TerraScale Dev CA on Client Machine

This file contains everything needed to trust the shared development CA
on a client PC. The CA was generated by `mkcert` on `terrascale-dev`
(192.168.10.101) and is valid for 10 years (until 2036-02-14).

Once installed, your browser will trust HTTPS connections to TerraScale and AgentsDashboard
services at `192.168.10.101` without certificate warnings.

## Trusted SANs

The server certificate covers these names/IPs:

- `localhost`
- `127.0.0.1`
- `::1`
- `192.168.10.101`
- `terrascale-dev`

## Step 1: Save the CA Certificate

Save the following certificate to a file named `terrascale-dev-ca.crt`:

```
-----BEGIN CERTIFICATE-----
MIIEoTCCAwmgAwIBAgIQMxsOycFFgBNKwDMWjKzU1jANBgkqhkiG9w0BAQsFADBp
MR4wHAYDVQQKExVta2NlcnQgZGV2ZWxvcG1lbnQgQ0ExHzAdBgNVBAsMFm1hcmlv
Z2tAdGVycmFzY2FsZS1kZXYxJjAkBgNVBAMMHW1rY2VydCBtYXJpb2drQHRlcnJh
c2NhbGUtZGV2MB4XDTI2MDIxNDAxMTUxOVoXDTM2MDIxNDAxMTUxOVowaTEeMBwG
A1UEChMVbWtjZXJ0IGRldmVsb3BtZW50IENBMR8wHQYDVQQLDBZtYXJpb2drQHRl
cnJhc2NhbGUtZGV2MSYwJAYDVQQDDB1ta2NlcnQgbWFyaW9na0B0ZXJyYXNjYWxl
LWRldjCCAaIwDQYJKoZIhvcNAQEBBQADggGPADCCAYoCggGBALVPwFlwTA9yUvCw
TuFqAs7vCUZj3NGhdAGzvlW71qfuUk6N2NzR1mVRgocN3AMaAWhg2iDDwdZGMIeh
6OWfom5iuOnont3Q7woAxqQt9pgzH5EqXgTFHaD8CdSOmgehQIbTy340se0ObcoU
9LDi7OGUEBNdh7pml3N4lj48wzYflGjy+vj0Di2W57VEwpxw8FqgjgVTXH7LRT8L
S0Cc8y797hZ48ZvAf+PQnQdq76lcVHtiuJ0RTNgUumtkXlr5PeHTBCtdNIQvK6al
r72LcaCah4+/o8G4B175Jyly97/wKiRcz7aotvQ85WVVLca5YuzuX4CRT5arkr98
AzdqskFICQeyqKX1vXH3yBpwpXeA7hCVyrC6zrG/+RuKGZvhYgIFC5APK4bK6Vad
kepg7hWhqTM+8qq/JSe0qgO4hjKS1JUZaUZ6SB9+FsDJMptyKMWvC+Np9+R565gg
ixwK3KkdhESVt+KHDKfQv77aQZBFKLFSjcqCRQ2zcFXZDlaNrQIDAQABo0UwQzAO
BgNVHQ8BAf8EBAMCAgQwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUP+Q3
RoZHB1JOjVRZSEgXHnwuRQUwDQYJKoZIhvcNAQELBQADggGBAJK9SzPSYsIG6Dxf
IyFxQHanTOMLC/XrjiXanzrojommd3bW0CRh6eSz9igPAAKkiAlRtFc8HHxQ/Y+D
n5w5X/nVM6AOf3reY7krdhN+rirrc0m/Z60H3RVvyT9r+LwY5mB0u6Y/aPExqpLd
IepCMK2Y7FI6yisqC2DLdjZ7qUemRckHOPAfQaAsQgy53qCh3wR51txchZREwC7s
ne3sIsGNXcv1ExYsdaW3Bvi/UgGhfG1Odj1liEAdfYEkR5hf4WjsEgfP++KteA9y
HvzTSA63MR2LZeI/85adZxmAkwsUuzypLPKi9s356zLodjak0wmqwU+9vDnR1KBa
n9HoviKpqYYxdn+ySplodGMmQ/ysFY+DKp4IHuq7OLZPGY2H5gPr1D6p0A2D2ZBh
ZmVyAEq6C/LbGSLVET4Y8JZZkvAvbOKAKsNK5LduL1Rwt0MmwGAIF9Cs1Nym3Fl6
seuMK+qgznu3abdWIk+hHISZnXBLDvUlV/eG3ddWnhvXZ77vYQ==
-----END CERTIFICATE-----
```

## Step 2: Install the CA

### Option A: Zen Browser GUI

1. Open Zen Browser
2. Go to **Settings** > **Privacy & Security**
3. Scroll to **Certificates** > click **View Certificates...**
4. Select the **Authorities** tab
5. Click **Import...**
6. Select the `terrascale-dev-ca.crt` file
7. Check **Trust this CA to identify websites**
8. Click **OK**

### Option B: CLI with `certutil` (Firefox/Zen profile)

```bash
# Find the Zen Browser profile directory
PROFILE_DIR=$(find ~/.zen -name "cert9.db" -exec dirname {} \; 2>/dev/null | head -1)

# If Zen stores profiles elsewhere, try:
# PROFILE_DIR=$(find ~/.var/app -name "cert9.db" -path "*/zen/*" -exec dirname {} \; 2>/dev/null | head -1)

# Import the CA (close Zen Browser first)
certutil -A -n "mkcert terrascale-dev" -t "C,," -i terrascale-dev-ca.crt -d sql:"$PROFILE_DIR"

# Verify it was added
certutil -L -d sql:"$PROFILE_DIR" | grep mkcert
```

### Option C: System-wide trust (Fedora / Universal Blue Aurora)

```bash
# Copy CA to system trust anchors
sudo cp terrascale-dev-ca.crt /etc/pki/ca-trust/source/anchors/terrascale-dev-ca.crt

# Update the system trust store
sudo update-ca-trust

# Verify
trust list | grep -A2 "mkcert"
```

> **Note:** System-wide trust works for Chromium-based browsers and `curl`.
> Firefox/Zen use their own certificate store, so you also need Option A or B.

### Option D: All-in-one script

```bash
#!/bin/bash
set -euo pipefail

CA_FILE="terrascale-dev-ca.crt"

# Save the certificate (copy the block from Step 1 into this file)
# Or download from the server:
# scp mariogk@192.168.10.101:~/.local/share/mkcert/rootCA.pem "$CA_FILE"

echo "==> Installing system-wide CA trust..."
sudo cp "$CA_FILE" /etc/pki/ca-trust/source/anchors/terrascale-dev-ca.crt
sudo update-ca-trust

echo "==> Installing into Zen Browser profile..."
PROFILE_DIR=$(find ~/.zen -name "cert9.db" -exec dirname {} \; 2>/dev/null | head -1)
if [ -n "$PROFILE_DIR" ]; then
    certutil -A -n "mkcert terrascale-dev" -t "C,," -i "$CA_FILE" -d sql:"$PROFILE_DIR"
    echo "    Added to: $PROFILE_DIR"
else
    echo "    WARNING: No Zen Browser profile found. Install manually via GUI."
fi

echo "==> Done. Restart your browser to apply changes."
echo ""
echo "Test with: curl -s https://192.168.10.101:5266 >/dev/null && echo OK || echo FAIL"
```

## Verification

After installing the CA, verify by visiting any service:

| Service | URL |
|---------|-----|
| AgentsDashboard | https://192.168.10.101:5266 |
| Dashboard | https://192.168.10.101:7114 |
| Admin | https://192.168.10.101:7115 |
| Server API | https://192.168.10.101:5295 |
| Registry | https://192.168.10.101:5100 |
| Aspire Dashboard | https://192.168.10.101:17227 |

You should see a green/secure lock icon with no certificate warnings.

## Removing the CA Later

### Zen Browser
Settings > Privacy & Security > View Certificates > Authorities >
find "mkcert mariogk@terrascale-dev" > Delete

### System-wide
```bash
sudo rm /etc/pki/ca-trust/source/anchors/terrascale-dev-ca.crt
sudo update-ca-trust
```

### CLI
```bash
certutil -D -n "mkcert terrascale-dev" -d sql:"$PROFILE_DIR"
```
